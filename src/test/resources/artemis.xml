<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE artemis PUBLIC "-//Devocative.Org//Artemis 1.0//EN"
		"https://devocative.org/dtd/artemis-1.0.dtd">

<artemis>

	<vars>
		<var name="cell" value="09${_.generate(9, '0'..'9')}"/>
		<var name="firstName" value="${_.generate(4, 'a'..'z')}"/>
		<var name="lastName" value="${_.generate(4, 'a'..'z')}"/>
		<var name="password" value="${_.generate(9, '0'..'9', 'a'..'z')}"/>
	</vars>

	<scenario name="RegisterRestaurateur">
		<get url="/restaurateurs/registrations/${cell}">
			<assertRs status="200" body="empty"/>
		</get>

		<get url="/j4d/registrations/${cell}">
			<assertRs status="200" properties="code"/>
		</get>

		<post url="/restaurateurs/registrations" id="register">
			<body><![CDATA[
{
    "firstName": "${firstName}",
    "lastName": "${lastName}",
    "cell": "${cell}",
    "code": "${_prev.rs.code}",
    "password": "${password}"
}
            ]]></body>

			<assertRs status="200" properties="userId,token"/>
		</post>

		<get url="/restaurateurs/${register.rs.userId}">
			<headers>
				<header name="Authorization" value="${register.rs.token}"/>
			</headers>

			<assertRs status="200" properties="id,firstName,lastName,cell,createdBy,createdDate,version"/>
		</get>

	</scenario>

	<scenario name="RegisterRestaurateur-DuplicateError">
		<get url="/restaurateurs/registrations/${cell}">
			<assertRs status="200" body="empty"/>
		</get>

		<get url="/j4d/registrations/${cell}">
			<assertRs status="200" properties="code"/>
		</get>

		<post url="/restaurateurs/registrations" id="register">
			<body><![CDATA[
{
    "firstName": "${firstName}",
    "lastName": "${lastName}",
    "cell": "${cell}",
    "code": "${_prev.rs.code}",
    "password": "${password}"
}
            ]]></body>

			<assertRs status="400" properties="code,description,fields"/>
		</post>
	</scenario>

	<scenario name="LoginRestaurateur">

		<post id="login" url="/restaurateurs/logins">
			<body><![CDATA[
{
	"cell": "${cell}",
	"password": "${password}"
}
			]]></body>

			<assertRs status="200" properties="userId,token"/>
		</post>

		<get url="/restaurateurs/${login.rs.userId}">
			<headers>
				<header name="Authorization" value="${login.rs.token}"/>
			</headers>

			<assertRs status="200" properties="id,firstName,lastName,cell,createdBy,createdDate,version"/>
		</get>

	</scenario>

</artemis>